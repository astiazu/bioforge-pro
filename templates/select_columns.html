<!-- templates/select_columns.html -->
{% extends "base.html" %}

{% block title %}Seleccionar Columnas - Análisis de Datos{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="fas fa-columns me-2 text-primary"></i>
                Selecciona columnas para graficar
            </h2>

            <!-- ✅ Vista previa del CSV -->
            <div class="card mb-5 shadow-sm">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table me-2 text-success"></i>
                        Vista previa de tus datos
                    </h5>
                    <small class="text-muted">Primeras 10 filas</small>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    {% for col in columns %}
                                    <th>{{ col }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in csv_preview %}
                                <tr>
                                    {% for col in columns %}
                                    <td>{{ row[col] }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Formulario de selección -->
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2 text-warning"></i>
                        Configuración del gráfico
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="x_column" class="form-label fw-bold">
                                    Eje X <small class="text-muted">(categoría, nombre o fecha)</small>
                                </label>
                                <select class="form-select" id="x_column" name="x_column" required>
                                    <option value="">Selecciona una columna...</option>
                                    {% for col in columns %}
                                    <option value="{{ col }}">{{ col }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="y_column" class="form-label fw-bold">
                                    Eje Y <small class="text-muted">(debe ser numérico: ID, horas, cantidad, etc.)</small>
                                </label>
                                <select class="form-select" id="y_column" name="y_column" required>
                                    <option value="">Selecciona una columna numérica...</option>
                                    {% for col in columns %}
                                        <option value="{{ col }}" 
                                                {% if col in numeric_columns %}
                                                    style="font-weight: bold; color: green;"
                                                {% endif %}>
                                            {{ col }}
                                            {% if col in numeric_columns %} ✅{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label for="chart_type" class="form-label fw-bold">Tipo de gráfico</label>
                                <select class="form-select" id="chart_type" name="chart_type">
                                    <option value="bar">Barras — ideal para comparar categorías</option>
                                    <option value="line">Línea — ideal para tendencias en el tiempo</option>
                                    <option value="scatter">Dispersión — ideal para ver relaciones entre variables</option>
                                </select>
                            </div>
                        </div>

                        <!-- Consejo de uso -->
                        <div class="alert alert-info mt-4 mb-0">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>¿No sabés qué elegir?</strong><br>
                            - Para <strong>eje Y</strong>, elegí una columna con números (como <em>ID</em>, <em>Horas</em>, <em>Cantidad</em>).<br>
                            - Para <strong>eje X</strong>, podés usar nombres, fechas o categorías (como <em>Asistente</em>, <em>Estado</em>, <em>Fecha_Limite</em>).
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-chart-line me-2"></i>Generar Gráfico
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="d-flex gap-2 mt-3">
                <a href="{{ url_for('routes.clear_csv') }}" class="btn btn-outline-danger">
                    <i class="fas fa-trash me-1"></i> Limpiar datos
                </a>
                <a href="{{ url_for('routes.upload_csv') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-upload me-1"></i> Subir otro CSV
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}