{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Mi Trabajo - {{ assistant.name }}</h2>
  <span class="badge bg-{{ 'success' if assistant.type == 'general' else 'secondary' }}">
    {{ 'Senior' if assistant.type == 'general' else 'Junior' }}
  </span>

  <!-- Mis tareas -->
  <h4>Mis tareas ({{ mis_tareas|length }})</h4>
  {% for task in mis_tareas %}
  <div class="card mb-3">
    <div class="card-body">
      <h5>{{ task.title }}</h5>
      <p>{{ task.description or "Sin descripción" }}</p>
      <small class="text-muted">Vence: {{ task.due_date or "Sin fecha" }}</small>
      
      <!-- Estados permitidos -->
      <div class="mt-2">
        {% if assistant.type == 'common' %}
          <!-- Junior: solo en proceso / completada -->
          <a href="#" class="btn btn-sm btn-warning">En proceso</a>
          <a href="#" class="btn btn-sm btn-success">Completada</a>
        {% else %}
          <!-- Senior: todos los estados -->
          <a href="#" class="btn btn-sm btn-warning">En proceso</a>
          <a href="#" class="btn btn-sm btn-success">Completada</a>
          <a href="#" class="btn btn-sm btn-secondary">Pausada</a>
          <a href="#" class="btn btn-sm btn-danger">Cancelada</a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}

  <!-- Tareas que asigné (solo Senior) -->
  {% if assistant.type == 'general' and tareas_asignadas_por_mi %}
  <h4 class="mt-5">Tareas que asigné ({{ tareas_asignadas_por_mi|length }})</h4>
  {% for task in tareas_asignadas_por_mi %}
  <div class="card mb-3">
    <div class="card-body">
      <h5>{{ task.title }} → {{ task.assistant.name }}</h5>
      <small class="text-muted">Estado: {{ task.status }}</small>
      <!-- Senior no puede eliminar -->
      <a href="#" class="btn btn-sm btn-outline-primary mt-2">Editar</a>
    </div>
  </div>
  {% endfor %}
  {% endif %}
</div>
{% endblock %}