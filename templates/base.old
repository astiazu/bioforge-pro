<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Datos Consultora - Consultor√≠a y Data{% endblock %}</title>
    <meta name="description" content="{{ description or 'Servicios de an√°lisis de datos y sistemas' }}">
    <meta property="og:image" content="{{ image_url or '/static/img/cloud-regular-full.svg' }}">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Favicon opcional -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <!-- Barra de navegaci√≥n -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <!-- Logo o nombre del portafolio -->
            <a class="navbar-brand" href="{{ url_for('routes.index') }}">Datos Consultora</a>

            <!-- Bot√≥n para m√≥viles -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Men√∫ de navegaci√≥n -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link {% if active_tab == 'home' or active_tab == 'inicio' %}active{% endif %}"
                           href="{{ url_for('routes.index') }}">
                            Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if active_tab == 'portfolio' %}active{% endif %}"
                           href="{{ url_for('routes.portfolio') }}">
                            Portafolio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if active_tab == 'publications' %}active{% endif %}"
                           href="{{ url_for('routes.publications') }}">
                            Publicaciones
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link {% if active_tab == 'blog_public' %}active{% endif %}"
                           href="{{ url_for('routes.public_notes') }}">
                            Blog P√∫blico
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if active_tab == 'profesionales' %}active{% endif %}"
                        href="{{ url_for('routes.profesionales') }}">
                            Profesionales
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if active_tab == 'upload_csv' %}active{% endif %}"
                           href="{{ url_for('routes.upload_csv') }}">
                            An√°lisis de Datos
                        </a>
                    </li>
                </ul>

                <!-- Dropdown de usuario o bot√≥n de login -->
                {% if current_user.is_authenticated %}
                    <div class="dropdown">
                        <a class="btn btn-outline-light dropdown-toggle" href="#" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false">
                            {{ current_user.username }}
                            {% if current_user.is_general_assistant and session.get('active_role') == 'asistente' %}
                                {% if active_assistant %}
                                <span class="badge bg-warning text-dark ms-3">
                                    <i class="fas fa-briefcase me-1"></i>
                                    Modo: Asistente en {{ active_assistant.doctor.username }}
                                </span>
                                {% endif %}
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <!-- Mi Perfil / Perfil del Equipo -->
                            <li>
                                {% if session.get('active_role') == 'asistente' %}
                                <a class="dropdown-item" href="{{ url_for('routes.perfil_equipo') }}">
                                    <i class="fas fa-building me-2"></i>Perfil del Equipo
                                </a>
                                {% else %}
                                <a class="dropdown-item" href="{{ url_for('routes.mi_perfil') }}">
                                    <i class="fas fa-user-circle me-2"></i>Mi Perfil
                                </a>
                                {% endif %}
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('routes.notes') }}">
                                    <i class="fas fa-newspaper me-2"></i>Mis Notas
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('routes.mi_agenda') }}">
                                    <i class="fa-regular fa-calendar me-2"></i> Mi Agenda
                                </a>
                            </li>
                            <!-- Bot√≥n condicional: Equipos -->
                            {% if current_user.is_authenticated and current_user.assistant_accounts %}
                            <li>
                                <a class="dropdown-item" href="{{ url_for('routes.mis_equipos') }}">
                                    <!-- <i class="fa-regular fa-people-group me-2"></i> Mis Equipos -->
                                    <i class="fa fa-users me-2"></i> Mis Equipos
                                </a>
                            </li>
                            {% endif %}
                            <li><a class="dropdown-item" href="{{ url_for('routes.mi_perfil') }}"><i class="fas fa-user-circle me-2"></i>Mi Perfil</a></li>
                            <!-- Bot√≥n condicional: Perfil de Asistente -->
                            {% if current_user.is_general_assistant and session.get('active_role') == 'asistente' %}
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('routes.perfil_asistente') }}">
                                    <i class="fas fa-briefcase me-2"></i>Perfil de Asistente
                                </a>
                            </li>
                            {% endif %}

                            <!-- Cambiar contrase√±a -->
                            <li>
                                <a class="dropdown-item" href="{{ url_for('routes.cambiar_pass') }}">
                                    <i class="fas fa-key me-2"></i>Cambiar Contrase√±a
                                </a>
                            </li>

                            <!-- Panel de Admin (solo si es admin) -->
                            {% if current_user.is_admin %}
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{{ url_for('routes.admin_panel') }}">
                                        <i class="fas fa-cog me-2"></i>Panel de Administraci√≥n
                                    </a>
                                </li>
                            {% endif %}
                            <li>
                                <a class="dropdown-item" href="{{ url_for('routes.dashboard') }}">
                                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                                </a>
                            </li>
                            <!-- Cerrar sesi√≥n -->
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                                    <i class="fas fa-sign-out-alt me-2"></i>Cerrar sesi√≥n
                                </a>
                            </li>
                        </ul>
                    </div>
                {% else %}
                    <a class="btn btn-outline-light" href="{{ url_for('auth.login') }}">
                        Iniciar sesi√≥n
                    </a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container mt-4 pt-5">
        <!-- Mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Bloque de contenido que ser√° reemplazado por cada p√°gina -->
        {% block content %}{% endblock %}
    </div>

    <!-- Footer opcional -->
    <footer class="footer mt-5 py-4 bg-dark text-light">
        <div class="container text-center">
            <p class="mb-0">
                &copy; 2025 Jos√© Luis Astiazu. Todos los derechos reservados.
            </p>
            <small class="text-primary">
                Desarrollado con Flask, Bootstrap y ‚ù§Ô∏è
            </small>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Bloque opcional para scripts espec√≠ficos de cada p√°gina -->
    {% block scripts %}{% endblock %}
</body>
</html>

<!-- copia del 19 de noviembre de 2025 -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}¬øTu PyME genera datos pero no los aprovecha? | DatosConsultora{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Convertimos datos dispersos de PyMEs en reportes que aumentan ventas +45%, reducen costos -30% y mejoran decisiones. ROI garantizado en 30 d√≠as.{% endblock %}">
    <meta name="keywords" content="business intelligence pymes, an√°lisis datos empresas, dashboard ejecutivo, consultor√≠a datos argentina">
    <meta name="author" content="DatosConsultora">

    <!-- Open Graph -->
    <meta property="og:title" content="{% block og_title %}DatosConsultora - Transformamos PyMEs con Datos{% endblock %}">
    <meta property="og:description" content="{% block og_description %}ROI +300% promedio. Convertimos tu caos de datos en decisiones rentables. Casos reales con resultados medibles.{% endblock %}">
    <meta property="og:image" content="{{ url_for('static', filename='img/og-image-datosconsultora.jpg', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_AR">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}DatosConsultora - Datos que Generan Dinero{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}PyMEs aumentan ventas +45% con nuestros dashboards. Diagn√≥stico gratuito en 30 min.{% endblock %}">
    <meta name="twitter:image" content="{{ url_for('static', filename='img/twitter-card-datosconsultora.jpg', _external=True) }}">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "DatosConsultora",
        "description": "Consultor√≠a especializada en an√°lisis de datos y Business Intelligence para PyMEs",
        "url": "{{ request.url_root }}",
        "telephone": "+54-354-440-4054",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Buenos Aires",
            "addressCountry": "AR"
        },
        "priceRange": "$$$",
        "serviceType": ["Business Intelligence", "Data Analysis", "Dashboard Development", "Process Automation"],
        "areaServed": "Argentina"
    }
    </script>
    <!-- Ubicaciones en el mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Preload & CSS -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/datosconsultora.css') }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16x16.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
        function trackEvent(action, category, label) {
            gtag('event', action, { event_category: category, event_label: label });
        }
    </script>
    <!-- Password -->    
    <script src="{{ url_for('static', filename='js/pass.js') }}" defer></script>
</head>
<body>
    <!-- WhatsApp Float -->
    <div class="whatsapp-float">
        <a href="https://wa.me/5493544404054" target="_blank" class="whatsapp-btn" onclick="trackEvent('click','contact','whatsapp-float')">
            <i class="fab fa-whatsapp"></i>
            <span class="tooltip-text">¬°Hablemos por WhatsApp!</span>
        </a>
    </div>

    <!-- Promo Bar -->
    <!-- <div class="notification-bar bg-warning text-dark text-center py-2" id="promo-bar">
        <div class="container">
            <strong>üöÄ OFERTA LIMITADA:</strong> Diagn√≥stico gratuito + 50% descuento
            <a href="{{ url_for('routes.index') }}#contacto-form" class="btn btn-dark btn-sm ms-2">Aprovechar</a>
            <button class="btn-close float-end" onclick="closePromoBar()"></button>
        </div>
    </div> -->

    <!-- Navbar -->
    {% include 'partials/navbar.html' %}

    <!-- Toast Carrito -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
        <div id="cart-toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">Producto agregado al carrito</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="container mt-4 pt-5">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'success' if category=='message' else category }} alert-dismissible fade show shadow-sm" role="alert">
                            <i class="fas fa-{% if category=='success' %}check-circle{% elif category=='error' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'partials/footer.html' %}

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/datosconsultora.js') }}"></script>

    {% block scripts %}{% endblock %}
    <script>
    document.addEventListener('scroll', () => {
    const navbar = document.querySelector('.navbar');
    if (!navbar) return;
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });
    </script>
    <script>
    let lastScrollTop = 0;
    const navbar = document.querySelector('.navbar');

    window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

    if (!navbar) return;

    // Solo aplica el efecto despu√©s de cierta altura
    if (currentScroll > 100) {
        if (currentScroll > lastScrollTop) {
        // Desliza hacia abajo ‚Üí oculta
        navbar.style.transform = 'translateY(-100%)';
        } else {
        // Desliza hacia arriba ‚Üí muestra
        navbar.style.transform = 'translateY(0)';
        }
    } else {
        // Siempre visible en la parte superior
        navbar.style.transform = 'translateY(0)';
    }

    lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    });
    </script>
    <script>
    function closePromoBar() {
        const bar = document.getElementById('promo-bar');
        if (bar) {
            bar.style.transition = "opacity 0.4s ease, height 0.4s ease";
            bar.style.opacity = "0";
            bar.style.height = "0";
            setTimeout(() => bar.remove(), 400); // elimina el elemento del DOM
        }
    }
    </script>
    <!-- Banner de Cookies -->
    {% if not session.get('cookies_accepted') %}
    <div id="cookie-banner" class="fixed-bottom bg-light p-3 text-center shadow">
        <p class="mb-2">
            Usamos cookies para mejorar tu experiencia. 
            <a href="{{ url_for('routes.cookies') }}" class="text-primary">M√°s informaci√≥n</a>.
        </p>
        <button id="accept-cookies" class="btn btn-primary btn-sm">Aceptar Cookies</button>
    </div>

    <script>
        // Script para aceptar cookies autom√°ticamente
        document.getElementById('accept-cookies').addEventListener('click', function () {
            fetch("{{ url_for('routes.cookies') }}", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "accept_cookies=yes"
            }).then(() => {
                document.getElementById('cookie-banner').style.display = 'none';
            });
        });
    </script>
    {% endif %}
</body>
</html>