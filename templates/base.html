<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}¬øTu PyME genera datos pero no los aprovecha? | DatosConsultora{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Convertimos datos dispersos de PyMEs en reportes que aumentan ventas +45%, reducen costos -30% y mejoran decisiones. ROI garantizado en 30 d√≠as.{% endblock %}">
    <meta name="keywords" content="business intelligence pymes, an√°lisis datos empresas, dashboard ejecutivo, consultor√≠a datos argentina">
    <meta name="author" content="DatosConsultora">

    <!-- Open Graph -->
    <meta property="og:title" content="{% block og_title %}DatosConsultora - Transformamos PyMEs con Datos{% endblock %}">
    <meta property="og:description" content="{% block og_description %}ROI +300% promedio. Convertimos tu caos de datos en decisiones rentables. Casos reales con resultados medibles.{% endblock %}">
    <meta property="og:image" content="{{ url_for('static', filename='img/og-image-datosconsultora.jpg', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_AR">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}DatosConsultora - Datos que Generan Dinero{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}PyMEs aumentan ventas +45% con nuestros dashboards. Diagn√≥stico gratuito en 30 min.{% endblock %}">
    <meta name="twitter:image" content="{{ url_for('static', filename='img/twitter-card-datosconsultora.jpg', _external=True) }}">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "DatosConsultora",
        "description": "Consultor√≠a especializada en an√°lisis de datos y Business Intelligence para PyMEs",
        "url": "{{ request.url_root }}",
        "telephone": "+54-354-440-4054",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Buenos Aires",
            "addressCountry": "AR"
        },
        "priceRange": "$$$",
        "serviceType": ["Business Intelligence", "Data Analysis", "Dashboard Development", "Process Automation"],
        "areaServed": "Argentina"
    }
    </script>
    <!-- Ubicaciones en el mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Preload & CSS -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/datosconsultora.css') }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='img/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='img/favicon-16x16.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/apple-touch-icon.png') }}">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
        function trackEvent(action, category, label) {
            gtag('event', action, { event_category: category, event_label: label });
        }
    </script>
    <!-- Password -->    
    <script src="{{ url_for('static', filename='js/pass.js') }}" defer></script>

    <!-- Estilos para el Modal de Suscripci√≥n -->
    <style>
        .subscription-benefit-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .subscription-benefit-item:last-child {
            border-bottom: none;
        }
        
        #subscriptionModal .modal-content {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        #subscriptionModal .modal-header {
            border-radius: 15px 15px 0 0;
        }
        
        .subscription-pulse {
            animation: subscriptionPulse 2s infinite;
        }
        
        @keyframes subscriptionPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .subscription-float-btn {
            z-index: 1040;
        }
    </style>
</head>
<body>
    <!-- WhatsApp Float -->
    <div class="whatsapp-float">
        <a href="https://wa.me/5493544404054" target="_blank" class="whatsapp-btn" onclick="trackEvent('click','contact','whatsapp-float')">
            <i class="fab fa-whatsapp"></i>
            <span class="tooltip-text">¬°Hablemos por WhatsApp!</span>
        </a>
    </div>

    <!-- Bot√≥n Flotante Suscripci√≥n -->
    <div class="position-fixed bottom-0 start-0 m-4 subscription-float-btn">
        <button class="btn btn-primary btn-lg rounded-pill shadow subscription-pulse" 
                data-bs-toggle="modal" 
                data-bs-target="#subscriptionModal"
                title="Suscr√≠bete para acceso completo">
            <i class="fas fa-gem me-2"></i>√önete
        </button>
    </div>

    <!-- Promo Bar -->
    <!-- <div class="notification-bar bg-warning text-dark text-center py-2" id="promo-bar">
        <div class="container">
            <strong>üöÄ OFERTA LIMITADA:</strong> Diagn√≥stico gratuito + 50% descuento
            <a href="{{ url_for('routes.index') }}#contacto-form" class="btn btn-dark btn-sm ms-2">Aprovechar</a>
            <button class="btn-close float-end" onclick="closePromoBar()"></button>
        </div>
    </div> -->

    <!-- Navbar -->
    {% include 'partials/navbar.html' %}

    <!-- Toast Carrito -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
        <div id="cart-toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">Producto agregado al carrito</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- Toast Suscripci√≥n -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100;">
        <div id="subscriptionToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-success text-white">
                <i class="fas fa-check-circle me-2"></i>
                <strong class="me-auto">¬°√âxito!</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Te hemos enviado tus credenciales de acceso al correo electr√≥nico.
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="container mt-4 pt-5">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'success' if category=='message' else category }} alert-dismissible fade show shadow-sm" role="alert">
                            <i class="fas fa-{% if category=='success' %}check-circle{% elif category=='error' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'partials/footer.html' %}

    <!-- Modal de Suscripci√≥n -->
    <div class="modal fade" id="subscriptionModal" tabindex="-1" aria-labelledby="subscriptionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="subscriptionModalLabel">
                        <i class="fas fa-rocket me-2"></i>¬°Desbloquea Todo el Contenido!
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="fas fa-gem fa-3x text-primary"></i>
                        </div>
                        <h4 class="fw-bold">√önete a Nuestra Comunidad</h4>
                        <p class="text-muted">Suscr√≠bete y accede a contenido exclusivo de profesionales</p>
                    </div>

                    <!-- Beneficios -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="subscription-benefit-item d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Acceso a todos los profesionales registrados</span>
                            </div>
                            <div class="subscription-benefit-item d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Contenido exclusivo y actualizaciones</span>
                            </div>
                            <div class="subscription-benefit-item d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Notificaciones de nuevos servicios</span>
                            </div>
                            <div class="subscription-benefit-item d-flex align-items-center mb-3">
                                <i class="fas fa-check-circle text-success me-3"></i>
                                <span>Ofertas especiales y descuentos</span>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de Suscripci√≥n -->
                    <form id="subscriptionForm" action="{{ url_for('routes.subscribe') }}" method="POST">
                        <div class="mb-3">
                            <label for="subscribeEmail" class="form-label fw-semibold">Correo Electr√≥nico</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" 
                                       class="form-control" 
                                       id="subscribeEmail" 
                                       name="email" 
                                       placeholder="tu@email.com" 
                                       required
                                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                            </div>
                            <div class="form-text">
                                Te enviaremos tus credenciales de acceso inmediatamente
                            </div>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="termsCheck" required>
                            <label class="form-check-label small" for="termsCheck">
                                Acepto los <a href="{{ url_for('routes.terminos_condiciones') }}" target="_blank" class="text-decoration-none">T√©rminos y Condiciones</a> 
                                y la <a href="{{ url_for('routes.politica_privacidad') }}" target="_blank" class="text-decoration-none">Pol√≠tica de Privacidad</a>
                            </label>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Suscribirse y Acceder
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Quiz√°s m√°s tarde
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-center">
                    <small class="text-muted">
                        ¬øYa tienes cuenta? <a href="{{ url_for('auth.login') }}" class="text-decoration-none">Inicia sesi√≥n aqu√≠</a>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/datosconsultora.js') }}"></script>

    <!-- Script para el Modal de Suscripci√≥n -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mostrar modal despu√©s de 3 segundos
        setTimeout(function() {
            // Verificar si el usuario ya est√° suscrito o logueado
            const isSubscribed = localStorage.getItem('userSubscribed');
            const isLoggedIn = {{ 'true' if current_user.is_authenticated else 'false' }};
            
            if (!isSubscribed && !isLoggedIn) {
                const subscriptionModal = new bootstrap.Modal(document.getElementById('subscriptionModal'));
                subscriptionModal.show();
            }
        }, 3000);

        // Manejar el formulario de suscripci√≥n
        const subscriptionForm = document.getElementById('subscriptionForm');
        if (subscriptionForm) {
            subscriptionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const email = formData.get('email');
                
                // Validaci√≥n b√°sica del email
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailPattern.test(email)) {
                    alert('Por favor ingresa un correo electr√≥nico v√°lido');
                    return;
                }

                // Mostrar loading
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Procesando...';
                submitBtn.disabled = true;
                
                // Enviar formulario
                fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error en la respuesta del servidor');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Mostrar toast de √©xito
                        const toastElement = document.getElementById('subscriptionToast');
                        const toastBody = toastElement.querySelector('.toast-body');
                        toastBody.textContent = data.message || '¬°Te has suscrito exitosamente! Revisa tu email para las credenciales.';
                        
                        const toast = new bootstrap.Toast(toastElement);
                        toast.show();
                        
                        // Cerrar modal despu√©s de 2 segundos
                        setTimeout(() => {
                            const modal = bootstrap.Modal.getInstance(document.getElementById('subscriptionModal'));
                            if (modal) {
                                modal.hide();
                            }
                        }, 2000);
                        
                        // Marcar como suscrito en localStorage
                        localStorage.setItem('userSubscribed', 'true');
                        
                        // Resetear formulario
                        subscriptionForm.reset();
                    } else {
                        alert(data.message || 'Error al suscribirse. Por favor intenta nuevamente.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al procesar la suscripci√≥n. Por favor intenta nuevamente.');
                })
                .finally(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
            });
        }

        // Validaci√≥n en tiempo real del email
        const emailInput = document.getElementById('subscribeEmail');
        if (emailInput) {
            emailInput.addEventListener('input', function() {
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (this.value && !emailPattern.test(this.value)) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });
        }
    });
    </script>

    {% block scripts %}{% endblock %}
    <script>
    document.addEventListener('scroll', () => {
    const navbar = document.querySelector('.navbar');
    if (!navbar) return;
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });
    </script>
    <script>
    let lastScrollTop = 0;
    const navbar = document.querySelector('.navbar');

    window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

    if (!navbar) return;

    // Solo aplica el efecto despu√©s de cierta altura
    if (currentScroll > 100) {
        if (currentScroll > lastScrollTop) {
        // Desliza hacia abajo ‚Üí oculta
        navbar.style.transform = 'translateY(-100%)';
        } else {
        // Desliza hacia arriba ‚Üí muestra
        navbar.style.transform = 'translateY(0)';
        }
    } else {
        // Siempre visible en la parte superior
        navbar.style.transform = 'translateY(0)';
    }

    lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    });
    </script>
    <script>
    function closePromoBar() {
        const bar = document.getElementById('promo-bar');
        if (bar) {
            bar.style.transition = "opacity 0.4s ease, height 0.4s ease";
            bar.style.opacity = "0";
            bar.style.height = "0";
            setTimeout(() => bar.remove(), 400); // elimina el elemento del DOM
        }
    }
    </script>
    <!-- Banner de Cookies -->
    {% if not session.get('cookies_accepted') %}
    <div id="cookie-banner" class="fixed-bottom bg-light p-3 text-center shadow">
        <p class="mb-2">
            Usamos cookies para mejorar tu experiencia. 
            <a href="{{ url_for('routes.cookies') }}" class="text-primary">M√°s informaci√≥n</a>.
        </p>
        <button id="accept-cookies" class="btn btn-primary btn-sm">Aceptar Cookies</button>
    </div>

    <script>
        // Script para aceptar cookies autom√°ticamente
        document.getElementById('accept-cookies').addEventListener('click', function () {
            fetch("{{ url_for('routes.cookies') }}", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "accept_cookies=yes"
            }).then(() => {
                document.getElementById('cookie-banner').style.display = 'none';
            });
        });
    </script>
    {% endif %}
</body>
</html>
